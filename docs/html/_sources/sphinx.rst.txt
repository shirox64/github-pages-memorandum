============
Sphinx入門
============

Sphinxとは
------------
Sphinxとは公式サイトによると知的で美しいドキュメントを簡単に作れるようにするツールらしいです。

インストール方法
----------------
SphinxはPythonのパッケージなのでpipでインストールします。 ::

  pip install sphinx

Sphinxの使い方
----------------

プロジェクトの作成
^^^^^^^^^^^^^^^^^^
プロジェクトは下記のコマンドで作成できます。 ::

  sphinx-quickstart

プロジェクト作成のコマンドを実行すると下記のようにいくつか質問されるので適当に入力します。 ::

  Sphinx 3.1.2 クイックスタートユーティリティへようこそ。

  以下の設定値を入力してください（Enter キーのみ押した場合、
  かっこで囲まれた値をデフォルト値として受け入れます）。

  選択されたルートパス: .

  Sphinx 出力用のビルドディレクトリを配置する方法は2つあります。
  ルートパス内にある "_build" ディレクトリを使うか、
  ルートパス内に "source" と "build" ディレクトリを分ける方法です。
  > ソースディレクトリとビルドディレクトリを分ける（y / n） [n]: y

  プロジェクト名は、ビルドされたドキュメントのいくつかの場所にあります。
  > プロジェクト名: memorandum
  > 著者名（複数可）: shirox64
  > プロジェクトのリリース []: 1.0.0

  ドキュメントを英語以外の言語で書く場合は、
  言語コードで言語を選択できます。Sphinx は生成したテキストをその言語に翻訳します。

  サポートされているコードのリストについては、
  https://www.sphinx-doc.org/en/master/usage/configuration.html#confval-language を参照してください。
  > プロジェクトの言語 [en]: ja

プロジェクトは下記のような構造で作成されます。 ::

  .
  ├── Makefile
  ├── build
  ├── make.bat
  └── source
      ├── _static
      ├── _templates
      ├── conf.py
      └── index.rst

ビルド
^^^^^^^
下記のコマンドでビルドするとbuildディレクトリが作成され、その中にhtmlファイルが生成されます。 ::

  make html

自動ビルド
^^^^^^^^^^
| 編集する度にビルドして確認するのは効率が悪いのでsphinx-autobuildを利用します。
| sphinx-autobuildのインストールコマンドは下記になります。 ::

  pip install sphinx-autobuild

下記のコマンドで自動的にビルトとブラウザの再リロードをしてくれるようになります。 ::

  sphinx-autobuild -b html source build/html

コマンド実行後、http://127.0.0.1:8000 にアクセスするとビルドした結果を確認できます。

Sphinxの書き方
----------------
後日更新予定

GitHub Pagesで公開
--------------------

GitHubでGitHub Pagesの設定
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
| GitHub Pagesの設定は対象のリポジトリのページのSettingsタブを選択して少し下にスクロールするとあります。
| GitHub Pagesで公開するソースのディレクトリはリポジトリ直下もしくはリポジトリ直下のdocsを選択できるみたいです。

.. image:: img/sphinx001.png

Sphinxのビルドの設定
^^^^^^^^^^^^^^^^^^^^^^^^^
| Sphinxのビルドしたファイルはデフォルトだとbuildディレクトリに作成されるのでMakefileとmake.batを修正し、docsディレクトリに作成されるように変更します。
Makefile ::

  # Minimal makefile for Sphinx documentation
  #

  # You can set these variables from the command line, and also
  # from the environment for the first two.
  SPHINXOPTS    ?=
  SPHINXBUILD   ?= sphinx-build
  SOURCEDIR     = source
  BUILDDIR      = docs

  # Put it first so that "make" without argument is like "make help".
  help:
    @$(SPHINXBUILD) -M help "$(SOURCEDIR)" "$(BUILDDIR)" $(SPHINXOPTS) $(O)

  .PHONY: help Makefile

  # Catch-all target: route all unknown targets to Sphinx using the new
  # "make mode" option.  $(O) is meant as a shortcut for $(SPHINXOPTS).
  %: Makefile
    @$(SPHINXBUILD) -M $@ "$(SOURCEDIR)" "$(BUILDDIR)" $(SPHINXOPTS) $(O)

make.bat ::

  @ECHO OFF

  pushd %~dp0

  REM Command file for Sphinx documentation

  if "%SPHINXBUILD%" == "" (
    set SPHINXBUILD=sphinx-build
  )
  set SOURCEDIR=source
  set BUILDDIR=docs

  if "%1" == "" goto help

  %SPHINXBUILD% >NUL 2>NUL
  if errorlevel 9009 (
    echo.
    echo.The 'sphinx-build' command was not found. Make sure you have Sphinx
    echo.installed, then set the SPHINXBUILD environment variable to point
    echo.to the full path of the 'sphinx-build' executable. Alternatively you
    echo.may add the Sphinx directory to PATH.
    echo.
    echo.If you don't have Sphinx installed, grab it from
    echo.http://sphinx-doc.org/
    exit /b 1
  )

  %SPHINXBUILD% -M %1 %SOURCEDIR% %BUILDDIR% %SPHINXOPTS% %O%
  goto end

  :help
  %SPHINXBUILD% -M help %SOURCEDIR% %BUILDDIR% %SPHINXOPTS% %O%

  :end
  popd

.nojekyllファイルの作成
^^^^^^^^^^^^^^^^^^^^^^^^^^
| GitHib PagesはJekyIIが使われており、_staticなどにあるファイルを読み取ることができないのでsphinxのcssが適用されません。
| そこでリポジトリの直下に.nojekyllというから空ファイルを配置する必要があります。

ソースの公開
^^^^^^^^^^^^
| 上記の設定が終われば、後はビルドしてプッシュするだけです。
| https://[ユーザ名].github.io/[リポジトリ名]/index.html にアクセスすると作成したドキュメントが確認できます。
